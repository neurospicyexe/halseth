name = "halseth"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# ── D1 (relational store) ────────────────────────────────────────────────────
[[d1_databases]]
binding  = "DB"
database_name = "halseth"
database_id   = "REPLACE_WITH_D1_DATABASE_ID"
migrations_dir = "migrations"

# ── R2 (artifact / blob store) ───────────────────────────────────────────────
[[r2_buckets]]
binding     = "BUCKET"
bucket_name = "halseth-artifacts"

# ── Config flags & household identity ────────────────────────────────────────
# These are the modularity knobs — change here, not in code.
[vars]
PLURALITY_ENABLED    = "false"   # "true" enables front_state validation against system.members
COMPANIONS_ENABLED   = "true"    # "false" returns 403 on companion routes
COORDINATION_ENABLED = "true"    # shared zone: tasks, events, lists, routines, etc.
SYSTEM_NAME          = "Halseth"
SYSTEM_OWNER         = "REPLACE_WITH_OWNER"

# Secrets — set via `wrangler secret put <KEY>` for production.
# For local dev, copy config/.dev.vars.example to .dev.vars and fill in values.
# ADMIN_SECRET    — protects POST /admin/bootstrap
# MCP_AUTH_SECRET — protects POST /mcp (optional; endpoint is open if unset)

# ── Workers AI (embeddings for Vectorize) ────────────────────────────────────
[ai]
binding = "AI"

# ── Vectorize (semantic memory search) ───────────────────────────────────────
[[vectorize]]
binding    = "VECTORIZE"
index_name = "halseth-memories"

# ── Local dev overrides ───────────────────────────────────────────────────────
[env.local]
# Secrets live in .dev.vars (gitignored). See config/.dev.vars.example.
